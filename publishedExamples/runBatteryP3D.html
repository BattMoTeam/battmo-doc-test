<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pseudo-Three-Dimensional (P3D) Lithium-Ion Battery Model &mdash; BattMo  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx_collapse.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/battmologo.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            BattMo
              <img src="../_static/battmologo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basicusage.html">Basic Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basicusage.html#a-first-battmo-model">A First <strong>BattMo</strong> Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basicusage.html#define-parameters">Define Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basicusage.html#run-simulation">Run Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basicusage.html#show-the-dashboard">Show the Dashboard</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basicusage.html#explore-the-output">Explore the Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basicusage.html#explore-the-grid">Explore the Grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basicusage.html#explore-the-states">Explore the States</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basicusage.html#plot-a-result">Plot a Result</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basicusage.html#change-control-parameters">Change Control Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basicusage.html#change-structural-parameters">Change Structural Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basicusage.html#change-material-parameters">Change Material Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basicusage.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../intermediate.html">Intermediate usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intermediate.html#pseudo-four-dimensional-p4d-model">Pseudo-Four-Dimensional (P4D) Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../intermediate.html#define-parameters">Define Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intermediate.html#run-simulation">Run Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intermediate.html#visualize-results">Visualize Results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../intermediate.html#direct-insertion-using-parsebattmojson">Direct insertion using <code class="code docutils literal notranslate"><span class="pre">parseBattmoJson</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../intermediate.html#merge-function-using-mergejsonstructs">Merge function using <code class="code docutils literal notranslate"><span class="pre">mergeJsonStructs</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../advancedtopics.html">Advanced Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modelinitialisation.html">Model initialisation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../modelinitialisation.html#how-to-initialise-the-model">How to initialise the model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modelinitialisation.html#calculating-intial-concentration">Calculating intial concentration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modelinitialisation.html#calculating-initial-potential">Calculating initial potential</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../thermal.html">Thermal Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controlinput.html">Control models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../controlinput.html#json-input-interface">Json input interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../optimisation.html">Optimisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../parsets.html">Parameter sets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../parsets.html#chen-2020">Chen 2020</a></li>
<li class="toctree-l3"><a class="reference internal" href="../parsets.html#safari-2009">Safari 2009</a></li>
<li class="toctree-l3"><a class="reference internal" href="../parsets.html#xu-2015">Xu 2015</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">BattMo Model Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../batteryinput.html">Battery cell</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../batteryinput.html#BatteryInputParams"><code class="docutils literal notranslate"><span class="pre">BatteryInputParams</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#BatteryInputParams.NegativeElectrode"><code class="docutils literal notranslate"><span class="pre">BatteryInputParams.NegativeElectrode</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#BatteryInputParams.PositiveElectrode"><code class="docutils literal notranslate"><span class="pre">BatteryInputParams.PositiveElectrode</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#BatteryInputParams.Electrolyte"><code class="docutils literal notranslate"><span class="pre">BatteryInputParams.Electrolyte</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#BatteryInputParams.Separator"><code class="docutils literal notranslate"><span class="pre">BatteryInputParams.Separator</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#BatteryInputParams.ThermalModel"><code class="docutils literal notranslate"><span class="pre">BatteryInputParams.ThermalModel</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#BatteryInputParams.Control"><code class="docutils literal notranslate"><span class="pre">BatteryInputParams.Control</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../batteryinput.html#electrode">Electrode</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../batteryinput.html#ElectrodeInputParams"><code class="docutils literal notranslate"><span class="pre">ElectrodeInputParams</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ElectrodeInputParams.Coating"><code class="docutils literal notranslate"><span class="pre">ElectrodeInputParams.Coating</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ElectrodeInputParams.CurrentCollector"><code class="docutils literal notranslate"><span class="pre">ElectrodeInputParams.CurrentCollector</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../batteryinput.html#coating">Coating</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../batteryinput.html#CoatingInputParams"><code class="docutils literal notranslate"><span class="pre">CoatingInputParams</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#CoatingInputParams.ActiveMaterial"><code class="docutils literal notranslate"><span class="pre">CoatingInputParams.ActiveMaterial</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#CoatingInputParams.Binder"><code class="docutils literal notranslate"><span class="pre">CoatingInputParams.Binder</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#CoatingInputParams.ConductingAdditive"><code class="docutils literal notranslate"><span class="pre">CoatingInputParams.ConductingAdditive</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../batteryinput.html#active-material">Active Material</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../batteryinput.html#ActiveMaterialInputParams"><code class="docutils literal notranslate"><span class="pre">ActiveMaterialInputParams</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ActiveMaterialInputParams.Interface"><code class="docutils literal notranslate"><span class="pre">ActiveMaterialInputParams.Interface</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ActiveMaterialInputParams.SolidDiffusion"><code class="docutils literal notranslate"><span class="pre">ActiveMaterialInputParams.SolidDiffusion</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ActiveMaterialInputParams.electronicConductivity"><code class="docutils literal notranslate"><span class="pre">ActiveMaterialInputParams.electronicConductivity</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ActiveMaterialInputParams.density"><code class="docutils literal notranslate"><span class="pre">ActiveMaterialInputParams.density</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ActiveMaterialInputParams.massFraction"><code class="docutils literal notranslate"><span class="pre">ActiveMaterialInputParams.massFraction</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ActiveMaterialInputParams.thermalConductivity"><code class="docutils literal notranslate"><span class="pre">ActiveMaterialInputParams.thermalConductivity</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ActiveMaterialInputParams.specificHeatCapacity"><code class="docutils literal notranslate"><span class="pre">ActiveMaterialInputParams.specificHeatCapacity</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ActiveMaterialInputParams.diffusionModelType"><code class="docutils literal notranslate"><span class="pre">ActiveMaterialInputParams.diffusionModelType</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../batteryinput.html#binder">Binder</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../batteryinput.html#BinderInputParams"><code class="docutils literal notranslate"><span class="pre">BinderInputParams</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#BinderInputParams.electronicConductivity"><code class="docutils literal notranslate"><span class="pre">BinderInputParams.electronicConductivity</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#BinderInputParams.density"><code class="docutils literal notranslate"><span class="pre">BinderInputParams.density</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#BinderInputParams.massFraction"><code class="docutils literal notranslate"><span class="pre">BinderInputParams.massFraction</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#BinderInputParams.thermalConductivity"><code class="docutils literal notranslate"><span class="pre">BinderInputParams.thermalConductivity</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#BinderInputParams.specificHeatCapacity"><code class="docutils literal notranslate"><span class="pre">BinderInputParams.specificHeatCapacity</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../batteryinput.html#conducting-additive">Conducting Additive</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../batteryinput.html#ConductingAdditiveInputParams"><code class="docutils literal notranslate"><span class="pre">ConductingAdditiveInputParams</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ConductingAdditiveInputParams.electronicConductivity"><code class="docutils literal notranslate"><span class="pre">ConductingAdditiveInputParams.electronicConductivity</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ConductingAdditiveInputParams.density"><code class="docutils literal notranslate"><span class="pre">ConductingAdditiveInputParams.density</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ConductingAdditiveInputParams.massFraction"><code class="docutils literal notranslate"><span class="pre">ConductingAdditiveInputParams.massFraction</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ConductingAdditiveInputParams.thermalConductivity"><code class="docutils literal notranslate"><span class="pre">ConductingAdditiveInputParams.thermalConductivity</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ConductingAdditiveInputParams.specificHeatCapacity"><code class="docutils literal notranslate"><span class="pre">ConductingAdditiveInputParams.specificHeatCapacity</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../batteryinput.html#interface">Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../batteryinput.html#InterfaceInputParams"><code class="docutils literal notranslate"><span class="pre">InterfaceInputParams</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#InterfaceInputParams.saturationConcentration"><code class="docutils literal notranslate"><span class="pre">InterfaceInputParams.saturationConcentration</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#InterfaceInputParams.numberOfElectronsTransferred"><code class="docutils literal notranslate"><span class="pre">InterfaceInputParams.numberOfElectronsTransferred</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#InterfaceInputParams.volumeFraction"><code class="docutils literal notranslate"><span class="pre">InterfaceInputParams.volumeFraction</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#InterfaceInputParams.volumetricSurfaceArea"><code class="docutils literal notranslate"><span class="pre">InterfaceInputParams.volumetricSurfaceArea</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#InterfaceInputParams.activationEnergyOfReaction"><code class="docutils literal notranslate"><span class="pre">InterfaceInputParams.activationEnergyOfReaction</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#InterfaceInputParams.reactionRateConstant"><code class="docutils literal notranslate"><span class="pre">InterfaceInputParams.reactionRateConstant</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#InterfaceInputParams.exchangeCurrentDensity"><code class="docutils literal notranslate"><span class="pre">InterfaceInputParams.exchangeCurrentDensity</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#InterfaceInputParams.guestStoichiometry100"><code class="docutils literal notranslate"><span class="pre">InterfaceInputParams.guestStoichiometry100</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#InterfaceInputParams.guestStoichiometry0"><code class="docutils literal notranslate"><span class="pre">InterfaceInputParams.guestStoichiometry0</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#InterfaceInputParams.density"><code class="docutils literal notranslate"><span class="pre">InterfaceInputParams.density</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#InterfaceInputParams.openCircuitPotential"><code class="docutils literal notranslate"><span class="pre">InterfaceInputParams.openCircuitPotential</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#InterfaceInputParams.chargeTransferCoefficient"><code class="docutils literal notranslate"><span class="pre">InterfaceInputParams.chargeTransferCoefficient</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../batteryinput.html#solid-diffusion-models">Solid Diffusion Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../batteryinput.html#SolidDiffusionModelInputParams"><code class="docutils literal notranslate"><span class="pre">SolidDiffusionModelInputParams</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#SolidDiffusionModelInputParams.particleRadius"><code class="docutils literal notranslate"><span class="pre">SolidDiffusionModelInputParams.particleRadius</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#SolidDiffusionModelInputParams.activationEnergyOfDiffusion"><code class="docutils literal notranslate"><span class="pre">SolidDiffusionModelInputParams.activationEnergyOfDiffusion</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#SolidDiffusionModelInputParams.referenceDiffusionCoefficient"><code class="docutils literal notranslate"><span class="pre">SolidDiffusionModelInputParams.referenceDiffusionCoefficient</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#SolidDiffusionModelInputParams.volumetricSurfaceArea"><code class="docutils literal notranslate"><span class="pre">SolidDiffusionModelInputParams.volumetricSurfaceArea</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../batteryinput.html#FullSolidDiffusionModelInputParams"><code class="docutils literal notranslate"><span class="pre">FullSolidDiffusionModelInputParams</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#FullSolidDiffusionModelInputParams.diffusionCoefficient"><code class="docutils literal notranslate"><span class="pre">FullSolidDiffusionModelInputParams.diffusionCoefficient</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#FullSolidDiffusionModelInputParams.saturationConcentration"><code class="docutils literal notranslate"><span class="pre">FullSolidDiffusionModelInputParams.saturationConcentration</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#FullSolidDiffusionModelInputParams.guestStoichiometry100"><code class="docutils literal notranslate"><span class="pre">FullSolidDiffusionModelInputParams.guestStoichiometry100</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#FullSolidDiffusionModelInputParams.guestStoichiometry0"><code class="docutils literal notranslate"><span class="pre">FullSolidDiffusionModelInputParams.guestStoichiometry0</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../batteryinput.html#SimplifiedSolidDiffusionModelInputParams"><code class="docutils literal notranslate"><span class="pre">SimplifiedSolidDiffusionModelInputParams</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../batteryinput.html#electrolyte">Electrolyte</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../batteryinput.html#ElectrolyteInputParams"><code class="docutils literal notranslate"><span class="pre">ElectrolyteInputParams</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ElectrolyteInputParams.density"><code class="docutils literal notranslate"><span class="pre">ElectrolyteInputParams.density</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ElectrolyteInputParams.ionicConductivity"><code class="docutils literal notranslate"><span class="pre">ElectrolyteInputParams.ionicConductivity</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ElectrolyteInputParams.diffusionCoefficient"><code class="docutils literal notranslate"><span class="pre">ElectrolyteInputParams.diffusionCoefficient</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ElectrolyteInputParams.bruggemanCoefficient"><code class="docutils literal notranslate"><span class="pre">ElectrolyteInputParams.bruggemanCoefficient</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ElectrolyteInputParams.thermalConductivity"><code class="docutils literal notranslate"><span class="pre">ElectrolyteInputParams.thermalConductivity</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ElectrolyteInputParams.specificHeatCapacity"><code class="docutils literal notranslate"><span class="pre">ElectrolyteInputParams.specificHeatCapacity</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../batteryinput.html#current-collector">Current Collector</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../batteryinput.html#CurrentCollectorInputParams"><code class="docutils literal notranslate"><span class="pre">CurrentCollectorInputParams</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#CurrentCollectorInputParams.thermalConductivity"><code class="docutils literal notranslate"><span class="pre">CurrentCollectorInputParams.thermalConductivity</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#CurrentCollectorInputParams.specificHeatCapacity"><code class="docutils literal notranslate"><span class="pre">CurrentCollectorInputParams.specificHeatCapacity</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#CurrentCollectorInputParams.density"><code class="docutils literal notranslate"><span class="pre">CurrentCollectorInputParams.density</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../batteryinput.html#electronic-component">Electronic Component</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../batteryinput.html#ElectronicComponentInputParams"><code class="docutils literal notranslate"><span class="pre">ElectronicComponentInputParams</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../batteryinput.html#ElectronicComponentInputParams.electronicConductivity"><code class="docutils literal notranslate"><span class="pre">ElectronicComponentInputParams.electronicConductivity</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../json.html">JSON input specification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../json.html#material-parameters">Material Parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../json.html#electrolyte">Electrolyte</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#electrode">Electrode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#coating">Coating</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#interface">Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#solid-diffusion">Solid Diffusion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#current-collector">Current Collector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#separator">Separator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#thermal-model">Thermal Model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../json.html#geometry-setup">Geometry Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../json.html#simulation-control-parameters">Simulation Control Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../json.html#time-stepping-parameters">Time Stepping Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../json.html#solver-parameters">Solver Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../json.html#output-parameters">Output Parameters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../geometryinput.html">Battery Geometries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#batterygeneratorp2d">BatteryGeneratorP2D</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../geometryinput.html#BatteryGeneratorP2D"><code class="docutils literal notranslate"><span class="pre">BatteryGeneratorP2D</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#batterygeneratorp3d">BatteryGeneratorP3D</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../geometryinput.html#BatteryGeneratorP3D"><code class="docutils literal notranslate"><span class="pre">BatteryGeneratorP3D</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#batterygeneratorp4d">BatteryGeneratorP4D</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../geometryinput.html#BatteryGeneratorP4D"><code class="docutils literal notranslate"><span class="pre">BatteryGeneratorP4D</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#spiralbatterygenerator">SpiralBatteryGenerator</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../geometryinput.html#SpiralBatteryGenerator"><code class="docutils literal notranslate"><span class="pre">SpiralBatteryGenerator</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#coincellbatterygenerator">CoinCellBatteryGenerator</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../geometryinput.html#CoinCellBatteryGenerator"><code class="docutils literal notranslate"><span class="pre">CoinCellBatteryGenerator</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#blockbatterygenerator">BlockBatteryGenerator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#coincellsectorbatterygenerator">CoinCellSectorBatteryGenerator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#flatbatterygenerator">FlatBatteryGenerator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#sectorbatterygenerator">SectorBatteryGenerator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#base-class">Base class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../geometryinput.html#BatteryGenerator"><code class="docutils literal notranslate"><span class="pre">BatteryGenerator</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../juliabridge.html">Julia bridge</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../juliabridge.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../juliabridge.html#setup-and-use">Setup and Use</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../gui.html">BattMo GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="runElectrolyser.html">Electrolyser simulation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#load-mrst-modules">Load MRST modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#setup-input">Setup input</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#setup-model">Setup model</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#setup-the-initial-condition">Setup the initial condition</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#setup-the-schedule-with-the-time-discretization">Setup the schedule with the time discretization</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#setup-the-non-linear-solver">Setup the non-linear solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#run-the-simulation">Run the simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#visualize-the-results">Visualize the results</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#ph-distribution-plot">pH distribution plot</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../seealso.html">See Also</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../mrst.html">MRST</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../mrst.html#id1">Visualization Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mrst.html#id2">Grid Factory Tutorial</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../fair.html">FAIR Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BattMo</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Pseudo-Three-Dimensional (P3D) Lithium-Ion Battery Model</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/publishedExamples/runBatteryP3D.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pseudo-three-dimensional-p3d-lithium-ion-battery-model">
<span id="runbatteryp3d"></span><h1>Pseudo-Three-Dimensional (P3D) Lithium-Ion Battery Model<a class="headerlink" href="#pseudo-three-dimensional-p3d-lithium-ion-battery-model" title="Link to this heading"></a></h1>
<p><em>Generated from runBatteryP3D.m</em></p>
<p>This example demonstrates how to setup a P3D model of a Li-ion battery and run a simple simulation.</p>
<section id="import-the-required-modules-from-mrst">
<h2>Import the required modules from MRST<a class="headerlink" href="#import-the-required-modules-from-mrst" title="Link to this heading"></a></h2>
<p>load MRST modules</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">mrstModule</span><span class="w"> </span><span class="s">add</span><span class="w"> </span><span class="s">ad-core</span><span class="w"> </span><span class="s">mrst-gui</span><span class="w"> </span><span class="s">mpfa</span>
</pre></div>
</div>
</section>
<section id="setup-the-properties-of-li-ion-battery-materials-and-cell-design">
<h2>Setup the properties of Li-ion battery materials and cell design<a class="headerlink" href="#setup-the-properties-of-li-ion-battery-materials-and-cell-design" title="Link to this heading"></a></h2>
<p>The properties and parameters of the battery cell, including the architecture and materials, are set using an instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">BatteryInputParams</span></code>. This class is used to initialize the simulation and it propagates all the parameters throughout the submodels. The input parameters can be set manually or provided in json format. All the parameters for the model are stored in the paramobj object.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">jsonstruct</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">parseBattmoJson</span><span class="p">(</span><span class="nb">fullfile</span><span class="p">(</span><span class="s">&#39;ParameterData&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;BatteryCellParameters&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;LithiumIonBatteryCell&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;lithium_ion_battery_nmc_graphite.json&#39;</span><span class="p">));</span>
<span class="n">jsonstruct</span><span class="p">.</span><span class="n">include_current_collectors</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="n">paramobj</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">BatteryInputParams</span><span class="p">(</span><span class="n">jsonstruct</span><span class="p">);</span>


<span class="c">% We define some shorthand names for simplicity.</span>
<span class="n">ne</span><span class="w">      </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;NegativeElectrode&#39;</span><span class="p">;</span>
<span class="n">pe</span><span class="w">      </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;PositiveElectrode&#39;</span><span class="p">;</span>
<span class="n">co</span><span class="w">      </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Coating&#39;</span><span class="p">;</span>
<span class="n">am</span><span class="w">      </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;ActiveMaterial&#39;</span><span class="p">;</span>
<span class="n">cc</span><span class="w">      </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;CurrentCollector&#39;</span><span class="p">;</span>
<span class="n">elyte</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Electrolyte&#39;</span><span class="p">;</span>
<span class="n">sep</span><span class="w">     </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Separator&#39;</span><span class="p">;</span>
<span class="n">thermal</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;ThermalModel&#39;</span><span class="p">;</span>
<span class="n">ctrl</span><span class="w">    </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Control&#39;</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="setup-the-geometry-and-computational-mesh">
<h2>Setup the geometry and computational mesh<a class="headerlink" href="#setup-the-geometry-and-computational-mesh" title="Link to this heading"></a></h2>
<p>Here, we setup the 2D computational mesh that will be used for the simulation. The required discretization parameters are already included in the class BatteryGeneratorP3D.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">gen</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">BatteryGeneratorP3D</span><span class="p">();</span>

<span class="c">% Now, we update the paramobj with the properties of the mesh.</span>
<span class="n">paramobj</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">gen</span><span class="p">.</span><span class="n">updateBatteryInputParams</span><span class="p">(</span><span class="n">paramobj</span><span class="p">);</span>

<span class="c">% change some of the values of the paramaters that were given in the json</span>
<span class="c">% file to other values. This is done directly on the object paramobj.</span>
<span class="n">paramobj</span><span class="p">.(</span><span class="n">ne</span><span class="p">).(</span><span class="n">cc</span><span class="p">).</span><span class="n">effectiveElectronicConductivity</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">1e5</span><span class="p">;</span>
<span class="n">paramobj</span><span class="p">.(</span><span class="n">pe</span><span class="p">).(</span><span class="n">cc</span><span class="p">).</span><span class="n">effectiveElectronicConductivity</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">1e5</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="initialize-the-battery-model">
<h2>Initialize the battery model.<a class="headerlink" href="#initialize-the-battery-model" title="Link to this heading"></a></h2>
<p>The battery model is initialized by sending paramobj to the Battery class constructor. see <code class="xref py py-class docutils literal notranslate"><span class="pre">Battery</span></code>.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Battery</span><span class="p">(</span><span class="n">paramobj</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="plot-the-mesh">
<h2>Plot the mesh<a class="headerlink" href="#plot-the-mesh" title="Link to this heading"></a></h2>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">plotBatteryMesh</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;setstyle&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
</pre></div>
</div>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runBatteryP3D_01.png" src="../_images/runBatteryP3D_01.png" />
</figure>
</section>
<section id="compute-the-nominal-cell-capacity-and-choose-a-c-rate">
<h2>Compute the nominal cell capacity and choose a C-Rate<a class="headerlink" href="#compute-the-nominal-cell-capacity-and-choose-a-c-rate" title="Link to this heading"></a></h2>
<p>The nominal capacity of the cell is calculated from the active materials. This value is then combined with the user-defined C-Rate to set the cell operational current.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="w">      </span><span class="p">=</span><span class="w"> </span><span class="n">computeCellCapacity</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="n">CRate</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">inputI</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">C</span><span class="o">/</span><span class="nb">hour</span><span class="p">)</span><span class="o">*</span><span class="n">CRate</span><span class="p">;</span><span class="w"> </span><span class="c">% current</span>
</pre></div>
</div>
</section>
<section id="setup-the-time-step-schedule">
<h2>Setup the time step schedule<a class="headerlink" href="#setup-the-time-step-schedule" title="Link to this heading"></a></h2>
<p>Smaller time steps are used to ramp up the current from zero to its operational value. Larger time steps are then used for the normal operation.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="w">           </span><span class="p">=</span><span class="w"> </span><span class="mi">25</span><span class="p">;</span>
<span class="n">dt</span><span class="w">          </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span>
<span class="n">dt</span><span class="w">          </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">dt</span><span class="p">;</span><span class="w"> </span><span class="nb">repmat</span><span class="p">(</span><span class="mf">0.5e-4</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="o">.*</span><span class="mf">1.5</span><span class="o">.^</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">)</span><span class="o">&#39;</span><span class="p">];</span>
<span class="n">totalTime</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="mf">1.4</span><span class="o">*</span><span class="nb">hour</span><span class="o">/</span><span class="n">CRate</span><span class="p">;</span>
<span class="n">n</span><span class="w">           </span><span class="p">=</span><span class="w"> </span><span class="mi">40</span><span class="p">;</span>
<span class="n">dt</span><span class="w">          </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">dt</span><span class="p">;</span><span class="w"> </span><span class="nb">repmat</span><span class="p">(</span><span class="n">totalTime</span><span class="o">/</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)];</span>
<span class="n">times</span><span class="w">       </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nb">cumsum</span><span class="p">(</span><span class="n">dt</span><span class="p">)];</span>
<span class="n">tt</span><span class="w">          </span><span class="p">=</span><span class="w"> </span><span class="n">times</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">end</span><span class="p">);</span>
<span class="nb">step</span><span class="w">        </span><span class="p">=</span><span class="w"> </span><span class="nb">struct</span><span class="p">(</span><span class="s">&#39;val&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">diff</span><span class="p">(</span><span class="n">times</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;control&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">ones</span><span class="p">(</span><span class="nb">numel</span><span class="p">(</span><span class="n">tt</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
</pre></div>
</div>
</section>
<section id="setup-the-operating-limits-for-the-cell">
<h2>Setup the operating limits for the cell<a class="headerlink" href="#setup-the-operating-limits-for-the-cell" title="Link to this heading"></a></h2>
<p>The maximum and minimum voltage limits for the cell are defined using stopping and source functions. A stopping function is used to set the lower voltage cutoff limit. A source function is used to set the upper voltage cutoff limit.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">control</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.(</span><span class="n">ctrl</span><span class="p">).</span><span class="n">setupScheduleControl</span><span class="p">();</span>

<span class="n">control</span><span class="p">.</span><span class="n">stopFunction</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">@(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">state_prev</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.(</span><span class="n">ctrl</span><span class="p">).</span><span class="n">E</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">2.0</span><span class="p">);</span>

<span class="c">% This control is used to set up the schedule</span>
<span class="n">schedule</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">struct</span><span class="p">(</span><span class="s">&#39;control&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">control</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;step&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">step</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="setup-the-initial-state-of-the-model">
<h2>Setup the initial state of the model<a class="headerlink" href="#setup-the-initial-state-of-the-model" title="Link to this heading"></a></h2>
<p>The initial state of the model is dispatched using the model.setupInitialState()method.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">initstate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">setupInitialState</span><span class="p">();</span>
</pre></div>
</div>
</section>
<section id="setup-the-properties-of-the-nonlinear-solver">
<h2>Setup the properties of the nonlinear solver<a class="headerlink" href="#setup-the-properties-of-the-nonlinear-solver" title="Link to this heading"></a></h2>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">nls</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">NonLinearSolver</span><span class="p">();</span>
<span class="c">% Change default maximum iteration number in nonlinear solver</span>
<span class="n">nls</span><span class="p">.</span><span class="n">maxIterations</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="c">% Change default behavior of nonlinear solver, in case of error</span>
<span class="n">nls</span><span class="p">.</span><span class="n">errorOnFailure</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="c">% Timestep selector</span>
<span class="n">nls</span><span class="p">.</span><span class="n">timeStepSelector</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">StateChangeTimeStepSelector</span><span class="p">(</span><span class="s">&#39;TargetProps&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{{</span><span class="n">ctrl</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;E&#39;</span><span class="p">}},</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                                  </span><span class="s">&#39;targetChangeAbs&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">0.03</span><span class="p">);</span>

<span class="c">% Change default tolerance for nonlinear solver</span>
<span class="n">model</span><span class="p">.</span><span class="n">nonlinearTolerance</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">1e-5</span><span class="p">;</span>
<span class="c">% Set verbosity of the solver (if true, value of the residuals for every equation is given)</span>
<span class="n">model</span><span class="p">.</span><span class="n">verbose</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="run-simulation">
<h2>Run simulation<a class="headerlink" href="#run-simulation" title="Link to this heading"></a></h2>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">wellSols</span><span class="p">,</span><span class="w"> </span><span class="n">states</span><span class="p">,</span><span class="w"> </span><span class="n">report</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">simulateScheduleAD</span><span class="p">(</span><span class="n">initstate</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">schedule</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                                </span><span class="s">&#39;OutputMinisteps&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                                </span><span class="s">&#39;NonLinearSolver&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nls</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="process-output-and-recover-the-output-voltage-and-current-from-the-output-states">
<h2>Process output and recover the output voltage and current from the output states.<a class="headerlink" href="#process-output-and-recover-the-output-voltage-and-current-from-the-output-states" title="Link to this heading"></a></h2>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">ind</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cellfun</span><span class="p">(@(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">not</span><span class="p">(</span><span class="nb">isempty</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="w"> </span><span class="n">states</span><span class="p">);</span>
<span class="n">states</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">states</span><span class="p">(</span><span class="n">ind</span><span class="p">);</span>
<span class="n">E</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cellfun</span><span class="p">(@(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="p">.(</span><span class="n">ctrl</span><span class="p">).</span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="n">states</span><span class="p">);</span>
<span class="n">I</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cellfun</span><span class="p">(@(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="p">.(</span><span class="n">ctrl</span><span class="p">).</span><span class="n">I</span><span class="p">,</span><span class="w"> </span><span class="n">states</span><span class="p">);</span>
<span class="nb">time</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cellfun</span><span class="p">(@(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">states</span><span class="p">);</span>

<span class="n">figure</span>
<span class="s">plot(time/hour,</span><span class="w"> </span><span class="s">E)</span><span class="p">;</span>
<span class="n">grid</span><span class="w"> </span><span class="s">on</span>
<span class="nb">xlabel</span><span class="w"> </span><span class="s">&#39;time  / h&#39;</span><span class="p">;</span>
<span class="n">ylabel</span><span class="w"> </span><span class="s">&#39;potential  / V&#39;</span><span class="p">;</span>
</pre></div>
</div>
<figure class="align-default" style="width: 100%">
<img alt="publishedExamples/runBatteryP3D_02.png" src="publishedExamples/runBatteryP3D_02.png" />
</figure>
</section>
<section id="plot-an-animated-summary-of-the-results">
<h2>Plot an animated summary of the results<a class="headerlink" href="#plot-an-animated-summary-of-the-results" title="Link to this heading"></a></h2>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">doplot</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="n">doplot</span>
<span class="w">    </span><span class="n">plotDashboard</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">states</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;step&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="k">end</span>
</pre></div>
</div>
<p>complete source code can be found <a class="reference internal" href="runBatteryP3D_source.html#runbatteryp3d-source"><span class="std std-ref">here</span></a></p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2023.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>